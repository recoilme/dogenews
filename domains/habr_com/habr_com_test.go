package habr_com

import (
	"fmt"
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

func Test_Links(t *testing.T) {
	habr := New("habr.com")
	links, err := habr.Links()
	assert.NoError(t, err)
	assert.Equal(t, true, len(links) > 10)
}

func Test_LinkOk(t *testing.T) {
	str := "https://habr.com/ru/post/557588/"
	habr := New("habr.com")
	res, ok := habr.LinkOk(str, true)
	assert.Equal(t, ok, true)
	assert.Equal(t, "https://habr.com/ru/post/557588/", res)
}

func Test_Article(t *testing.T) {
	habr := New("habr.com")
	txt := `Хотите выиграть приз в миллион долларов от Илона Маска? Улавливание углерода (УУ) в наши дни – тема чрезвычайно популярная. Десятки новых компаний занимаются вопросом удаления лишнего CO2 из атмосферы с целью стабилизации климата. Сам я не эксперт по УУ, но периодически мне задают вопросы на эту тему. Поэтому я предлагаю вам данную статью, чтобы помочь организовать наши мысли и уточнить стратегию по разработке и оценке широкого спектра систем улавливания углерода (СУУ). Стоит ли чего-то наша технология УУ? Давайте изучим нашу гипотетическую машину для УУ с двух точек зрения: физической и экономической. Физика Не является ли наша машина скрытым вечным двигателем? В прошлой жизни я несколько лет занимался проектированием маглев-систем, и часто натыкался на концепции других проектировщиков, эффективность которых была слишком идеальной для реального мира. Если сопротивление системы отрицательно, это вечный двигатель. Если на концентрацию CO2 система тратит меньше энергии, чем на выпуск его в воздух – это вечный двигатель. Если наша машина сжимает поток газа без расхода энергии или генерации паразитного тепла, она нарушает законы термодинамики. Вечные двигатели, очевидно, не существуют – так что проверяйте математику! Что такого известно нам, чего не знают все остальные? Что это за неочевидный противоречивый факт? Как наша система его использует? Сколько энергии реально потребляет наша система? СУУ иногда используют температурное чередование в слоях сорбента или электрохимическое разделение для увеличения концентрации CO2 с обычной, 420 частей на миллион (0,042 об. %), до почти 100%. Требуется ли для работы нашей системы много электрической или тепловой энергии? Откуда она берётся? Если это электрохимическая система, она использует больше или меньше энергии на моль CO2 по сравнению с выплавкой алюминия (1500 кДж/моль)? Используется ли там большой ток малого напряжения? Есть ли у нас под рукой униполярный генератор? Сколько меди требует система? Если при напряжении ячейки Y нам требуется Х электронов на молекулу CO2, получается X*Y*95 кДж/моль. Насколько близко мы подобрались к этому ограничению? Уменьшает ли наша система суммарное количество CO2 в воздухе? Если наша система по сбору CO2 выделяет оксид кальция (негашёную известь), образующуюся при термическом кальцинировании и сжигании природного газа, она будет выделять больше CO2, чем уловит за весь срок службы. Оп-па. Более общий вопрос: сколько лет она должна работать, чтобы превысить количество CO2, выделенное за время работы? Как мы подходим к оценке теоретических ограничений? Энтропия Гиббса растворения CO2 в атмосфере равняется примерно 19,4 кДж/моль. Это небольшое значение – поэтому никто не занимается генерацией энергии при помощи осмотического градиента концентрированного CO2 в атмосфере. Приближается ли наша система к этому параметру хоть сколько-нибудь заметно? А надо ли это ей? Может ли она к нему приблизиться? Если мы используем электрохимическое разделение, как мы справляемся с омическим нагревом и вязкостью? Является ли электрическая эффективность одним из основных ограничений нашей системы? Нужно ли ей быть эффективной, и каковы альтернативные издержки повышения эффективности на 1%? Если электричество будет дешеветь на 1% в год, эквивалентно ли это будет виртуальному увеличению её эффективности на 1%? Действительно ли наша машина концентрирует атмосферный CO2? Наш агрегат мигает лампочками, а из трубы у неё выходит CO2 с концентрацией в 100%. Значит, всё норм? Не совсем. Сохраняет ли она углерод? Не сжигаем ли мы случайно части нашей машины? Точно? Думаю, что в данном случае идеальным стандартом будет нулевой радиоуглеродный возраст CO2, полученного концентрацией из атмосферы – при этом CO2 полученный, допустим, в результате случайного электролиза добытого из земли карбоната будет очень старым и не радиоактивным. Для проверки углерода-14 требуется масс-спектрометр. В США полно лабораторий, которые за несколько сотен долларов проведут такой тест, хотя обычно образец сначала нужно будет превратить в графит. Однако датирование углерода не лишено недостатков – органические источники углерода, типа растительных масел, дерева или угля, молодые с точки зрения радиоуглеродного датирования. Так что если наша машина использует, допустим, кондитерский жир для смазки, нам нужно тщательно проверить математику, а также задуматься о том, что мы вообще делаем. Можем ли мы подтвердить наши результаты? Понимаем ли мы нашу систему тестирования? Описали ли мы каждый аспект работы машины количественно? Не запутает ли видео с презентацией её работы инвесторов? Очевидны ли ключевые вехи? Сможет ли человек, посмотревший видео, сам построить такую машину и провести такое же испытание? Хорошо ли описаны информация по тесту и результаты для того, чтобы их мог проверить независимый эксперт? Хорошо ли мы понимаем, как должен выглядеть и восприниматься хорошо задокументированный эксперимент, или нам надо пойти прочесть работу-другую по биологии? В области УУ можно встретить множество слабо разбирающихся в этом людей, и нам нужно задать высокий уровень стандартам документирования. Мы не планируем публиковать секреты наших разработок, но вряд ли можно ожидать, что инвесторы будут расставаться со своими деньгами в обмен на обещания и надежды. Можно ли масштабировать наш проект? Есть ли фундаментальные физические ограничения на реализацию проекта? Если мы собираемся собирать по 10 Гт CO2 в год, высаживая деревья, сколько воды потребуется, чтобы их поливать? Сможет ли фотосинтез конкурировать с добычей ископаемых? Какие фундаментальные ограничения на масштабирование нашего проекта? Есть ли доступ к капиталам? Окупаемость инвестиций? Нужны ли редкие реагенты? Нет ли у компании подозрительных сооснователей? Есть ли доступ к энергосетям достаточной мощности? Каков легальный статус углеродных налогов? Готова ли наша СУУ к выходу из лаборатории? Система питания двигателя, использовавшаяся компанией Tesla на заре деятельности, была чрезвычайно ненадёжной. Там использовались десятки аналоговых операционных усилителей, крутивших асинхронный мотор переменного тока. История полна проектов, которые не могли окупиться, поскольку были недостаточно взрослыми для выхода в производство. Есть ли у нас какая-то лабораторная модель, которую можно показать людям? Работает ли она? Ясно ли, какие её части сделаны наскоро, а какие имеют реальное значение? Безопасно ли находиться с ней в одной комнате? Готова ли технология к производству? Можем ли мы дать прототип среднему инженеру, недавно закончившему институт, и сказать «сделай нам 10 000 штук таких», и быть достаточно уверенными в том, что получатся рабочие, надёжные и достаточно эффективные приборы? Разобрались ли мы со всеми ошибками перед тем, как искать крупных инвестиций, или машина находится на уровне научного эксперимента? Финансы Сколько стоит наш CO2? Можем ли выдавать CO2 по $1000 за тонну, по $100 или по $10? Сколько стоит наш CO2? Сколько мы хотим, чтобы он стоил? А сколько нужно, чтобы он стоил? Как мы выглядим в сравнении с конкурентами? Насколько можно доверять нашим планам по улучшению машины? Насколько дорогая наша СУУ? Какова структура капитальных расходов? Сколько тонн CO2 машина должна уловить, чтобы окупить себя за вычетом операционных расходов, стоимости финансирования, амортизации? Сколько времени на это уйдёт? Если наша машина улавливает килограмм CO2 в день при стоимости $100 за тонну, она заработает $36,5 в год. Если стоимость постройки нашей машины составит $500, то чтобы окупить только эту стоимость, потребуется 15 лет. Траты в $500 за запчасти и труд находятся где-то в промежутке от большого торта до простейшей посудомойки, если говорить о масштабе и сложности проекта. Любой мало-мальски умелый техник должен собирать пяток таких машин в день, то есть, мы должны выдавать примерно 1500 машин в год. И всё равно прибыль составит всего $50 000, чего не хватит даже на обучение в институте [в США / прим. пер.]. Если капитальные расходы амортизируются за 10-30 лет работы, как оценить капитальные затраты? Рассчитываем ли мы на правительственные займы с низкой процентной ставкой? Будем ли мы андеррайтерами для наших клиентов, покупающих у нас устройства? Как диверсифицировать риски в данной области, учитывая их сильную корреляцию (как в технологических, так и в регуляторных областях)? Или мы сможем отбить затраты за несколько месяцев или лет, и рассчитывать на кратковременный кредит или даже собственные средства? Как быстро машина изнашивается? Не обесценивается ли она быстрее, чем окупается? Какова стоимость работы СУУ? Какие у нас операционные расходы? Нужны ли рабочие для обслуживания? Какие у машины расходники – реагенты, клапана, фурнитура, насосы, электроды, ПО? Как операционные расходы укладываются в график амортизации капитальных расходов? Не тратит ли машина на работу больше, чем на амортизацию? Оправдается ли усложнение конструкции с целью уменьшения текущих расходов? Или же машина настолько надёжная, что её можно включить и забыть – и НАСА сможет использовать её для работы с атмосферой на Луне? Развёртываем мы машину у себя во дворе или где-нибудь в пустыне? Как мы будем добираться до клиентов и осуществлять поддержку оборудования в удалённых или труднодоступных местах? Вернёмся к энергии Важна ли стоимость энергии для финансового плана? Десять лет назад стоимость электричества делала «зелёный водород» (полученный при помощи электролиза из воды) слишком дорогим по сравнению с «голубым» (полученным из природного газа паровой конверсией). Сегодня солнечная электроэнергия в пиковые часы обходится в 10 раз дешевле. Как изменятся наша бизнес-модель и оптимизация системы, если электричество станет дороже, или, наоборот, дешевле во время срока службы нашей машины? Энергоёмкий ли наш процесс? Сравним ли он с охлаждением или электроочисткой магния? Не привлечём ли мы внимания властей как нелегальная плантация запрещённой травы или дата-центр? Насколько хрупкая у нас цепочка поставок? Зависит ли наша машина от редких материалов? Чего мы не сможем купить в стройматериалах или на сайте Alibaba? Или на сайте «Шёлковый путь»? Легко ли нам поменять поставщиков, или наш проект зависит от состояния бизнеса и доброй воли единственной фирмы где-то во Внешней Монголии? Поглощаем ли мы CO2 при помощи амидов, цеолитов или металл-органических каркасных структур? Насколько дороги эти особые материалы? Работают ли в лаборатории, способной их производить, наши родственники или супруг(а)? Могут ли они масштабировать производство так же быстро, как мы – бизнес, и с какой маргинальной стоимостью? Сколько стоят металл-органические каркасные структуры? Есть ли у нас в списке покупок хоть что-нибудь более токсичное, чем считается приемлемым, или требующее особо осторожного обращения? Плутоний? Запрещённые вещества? Диоксидифторид? Раствор «пиранья»? Нужны ли нам сертифицированные специалисты? Потянем ли мы их медстраховку? Не заинтересуем ли мы управление по борьбе с наркотиками или министерство внутренней безопасности? Зависит ли наш процесс от доступности и доброй воли одного или нескольких узкоспециализированных докторов наук? Есть ли у нас план удержания талантов? Насколько экзотичен наш процесс? Нужны ли нам волшебные материалы? Работает ли наша система только с веществами, чистыми на 99,999999%? Что будет в случае загрязнения – никаких проблем, понизится эффективность или всё внезапно может рвануть? Испортят ли наши катализаторы обычные загрязнители воздуха – водяной пар, кислород, запах пад-тай? Расходуются ли катализаторы в системе? Не являются ли они тайными расходными материалами? Есть у нас план по поставкам, обслуживанию и замене того, что мы не планировали портить? Сколько кобальта нам нужно на тонну CO2? Нужно ли нам волшебство масштабирования? Все знают, что относительная дешевизна автомобилей возможна за счёт огромных и дорогих производств, благодаря которым можно ежегодно производить сотни тысяч абсолютно одинаковых экземпляров. Есть ли у нашей СУУ та же проблема, из-за которой мы не можем снизить капитальные расходы до приемлемых, пока не построим полностью автоматическую фабрику в миллион квадратных метров? Почему её нельзя собирать на манер LEGO? Строили ли мы сами огромную автоматическую фабрику? Идут ли эти знания на пользу делу? Может, нам лучше предлагать людям полностью автоматические фабрики в миллион квадратных метров как услугу? Есть ли вообще критический масштаб, ниже которого у нашей системы нет смысла? Можем ли мы оправдать экономику масштаба, или мы просто фантазируем, из-за того, что построить нашу систему будет дороже, чем заработать за 20 лет, получая по $1000 за тонну? Есть ли у нас поток доходов? Или нам нужно полагаться на скоординированные действия нескольких десятков правительств, утверждающих надёжные налоговые льготы или выплаты, образующие рынок бесконечной глубины с нулевой эластичностью для продажи CO2? Куда пойдёт наш концентрированный CO2? Превратится в топливо? Пластик? Копоть? Графит? Цемент? Пойдёт под землю? В газировку? Какова ежегодная ёмкость этих рынков? Какой её процент мы уловим? Если мы продаём наш CO2 только PepsiCo, он очень быстро вернётся а втмосферу. Есть ли у нас план по более надёжному хранению CO2? Кто будет покупать у нас CO2, в какой форме, сколько и по какой цене? Как будет выглядеть наш бизнес, если этот рынок будет насыщен? Допустим, если мы продаём 1000 тонн в год по $100 за тонну, доход нашего бизнеса составляет $100 тысяч в год. Достаточно ли этого для работы команды? Где в бизнесе создаётся ценность? Если мы делаем СУУ, которую через 20 лет надо амортизировать, мы продаём очень дорогие виджеты любителям долгов, и хорошо бы в больших количествах. Что в машине самое дорогое? Где мы добавляем ценность? Допустим, мы делаем СУУ на качающихся цеолитовых ячейках, типа таких, что используются на МКС. Большую часть их стоимости составляют новые цеолиты. Для уменьшения стоимости и улучшения контроля качества мы решили интегрировать в процесс производство цеолитов, улучшив стоимость на 20%. Поскольку цеолиты составляли порядка 90% капитальных расходов машины, теперь более 95% ценности компании состоит в производстве цеолитов. И что, мы теперь замаскированная цеолитовая фабрика? И если в долгосрочной перспективе улавливание CO2 промышленных масштабов будет сильно зависеть от массового производства экзотических материалов, как компьютерная индустрия зависела от фотолитографии на безумно чистых кремниевых кристаллов, имеет ли смысл вертикализация промышленности? С чего мы начинаем в этой цепочке ценностей, и где заканчиваем? Поставка химических веществ как услуга?`
	a, err := habr.Article("https://habr.com/ru/post/557588/")
	assert.NoError(t, err)
	assert.Equal(t, "Итак, вы хотите создать компанию по улавливанию и хранению углерода", a.Title)

	assert.Equal(t, "Хотите выиграть приз в миллион долларов от Илона Маска? Улавливание углерода (УУ) в наши дни – тема чрезвычайно популярная. Десятки новых компаний занимаются вопросом удаления лишнего CO2 из...", a.Summary)
	assert.Equal(t, "https://habr.com/share/publication/557588/be59781d23b1be03e7f5c3a949cc67e4/", a.ImageBanner)
	assert.Equal(t, "width=1200&height=630", a.ImageBannerMeta)

	assert.Equal(t, "2021-05-16 00:51:48 +0300 MSK", a.DatePub.String())

	assert.Equal(t, "экология", a.Category)
	assert.Equal(t, true, a.CntView >= 3500)

	assert.Equal(t, true, a.CntLike > 10)
	assert.Equal(t, true, a.CntComm > 29)

	assert.Equal(t, "@SLY_G", a.AuthorName)
	assert.Equal(t, "https://habr.com/ru/users/SLY_G/", a.AuthorUrl)
	assert.Equal(t, "https://habrastorage.org/getpro/habr/avatars/329/fc8/9e5/329fc89e55a9132bf200ff315065f3f7.jpg", a.AuthorAva)
	_ = txt
	//assert.Equal(t, txt, a.ContentText)

}

func Test_Time(t *testing.T) {
	dt := "2021-05-15T21:51:48.000Z"
	datePub, err := time.Parse(time.RFC3339, dt)
	assert.NoError(t, err)
	msk, err := time.LoadLocation("Europe/Moscow")
	if err != nil {
		panic(err)
	}
	datePub = datePub.In(msk)
	fmt.Println(datePub)
}
